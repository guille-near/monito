<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flying Monkey üêµ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2d5016 0%, #1a2e0a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            width: 400px;
            height: 600px;
            background: linear-gradient(180deg, 
                #87CEEB 0%, 
                #98FB98 20%, 
                #228B22 40%, 
                #006400 60%, 
                #2F4F2F 80%, 
                #1C3A1C 100%);
            border: 3px solid #4A5D23;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 
                0 0 20px rgba(0, 0, 0, 0.5),
                inset 0 0 30px rgba(0, 100, 0, 0.2);
        }

        #monkey {
            position: absolute;
            left: 80px;
            top: 250px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: top 0.15s ease-out;
            z-index: 15;
            transform-origin: center center;
            filter: drop-shadow(3px 3px 6px rgba(0, 0, 0, 0.4));
        }

        #monkey img {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .jungle-tree {
            position: absolute;
            width: 80px;
            border: none;
            border-radius: 0;
            overflow: hidden;
        }

        .jungle-tree-top {
            top: 0;
            background: 
                /* Hojas densas superiores */
                radial-gradient(ellipse at 20% 80%, #228B22 30%, transparent 35%),
                radial-gradient(ellipse at 50% 90%, #32CD32 40%, transparent 45%),
                radial-gradient(ellipse at 80% 85%, #228B22 25%, transparent 30%),
                /* Hojas medias */
                radial-gradient(ellipse at 30% 70%, #006400 35%, transparent 40%),
                radial-gradient(ellipse at 70% 75%, #228B22 30%, transparent 35%),
                /* Hojas inferiores m√°s densas */
                radial-gradient(ellipse at 40% 95%, #32CD32 45%, transparent 50%),
                radial-gradient(ellipse at 60% 100%, #228B22 40%, transparent 45%),
                /* Tronco */
                linear-gradient(to right, 
                    transparent 35px, 
                    #654321 35px, 
                    #8B4513 38px, 
                    #654321 42px, 
                    #8B4513 45px, 
                    transparent 45px),
                /* Fondo de follaje denso */
                linear-gradient(180deg, #228B22 0%, #006400 100%);
            box-shadow: 
                inset 2px 0 4px rgba(0, 100, 0, 0.3),
                inset -2px 0 4px rgba(0, 50, 0, 0.2);
        }

        .jungle-tree-bottom {
            bottom: 0;
            background: 
                /* Hojas superiores */
                radial-gradient(ellipse at 30% 15%, #32CD32 40%, transparent 45%),
                radial-gradient(ellipse at 70% 10%, #228B22 35%, transparent 40%),
                /* Hojas medias densas */
                radial-gradient(ellipse at 20% 25%, #006400 45%, transparent 50%),
                radial-gradient(ellipse at 50% 20%, #228B22 50%, transparent 55%),
                radial-gradient(ellipse at 80% 30%, #32CD32 40%, transparent 45%),
                /* Hojas inferiores */
                radial-gradient(ellipse at 40% 40%, #228B22 35%, transparent 40%),
                radial-gradient(ellipse at 60% 35%, #006400 30%, transparent 35%),
                /* Tronco */
                linear-gradient(to right, 
                    transparent 35px, 
                    #654321 35px, 
                    #8B4513 38px, 
                    #654321 42px, 
                    #8B4513 45px, 
                    transparent 45px),
                /* Fondo de follaje denso */
                linear-gradient(180deg, #006400 0%, #228B22 100%);
            box-shadow: 
                inset 2px 0 4px rgba(0, 100, 0, 0.3),
                inset -2px 0 4px rgba(0, 50, 0, 0.2);
        }

        /* Elementos decorativos de la selva */
        .jungle-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                /* Monta√±as lejanas */
                radial-gradient(ellipse at 20% 85%, rgba(34, 139, 34, 0.3) 30%, transparent 35%),
                radial-gradient(ellipse at 60% 90%, rgba(34, 139, 34, 0.2) 40%, transparent 45%),
                radial-gradient(ellipse at 90% 88%, rgba(34, 139, 34, 0.3) 25%, transparent 30%),
                /* Nubes */
                radial-gradient(ellipse at 15% 15%, rgba(255, 255, 255, 0.8) 8%, transparent 12%),
                radial-gradient(ellipse at 85% 20%, rgba(255, 255, 255, 0.6) 12%, transparent 16%),
                radial-gradient(ellipse at 50% 10%, rgba(255, 255, 255, 0.7) 10%, transparent 14%);
            z-index: 1;
            pointer-events: none;
        }

        /* Hojas flotantes */
        .floating-leaf {
            position: absolute;
            width: 12px;
            height: 8px;
            background: radial-gradient(ellipse, #228B22 60%, transparent 70%);
            border-radius: 50% 10% 50% 10%;
            animation: floatLeaf 4s ease-in-out infinite;
            z-index: 5;
        }

        @keyframes floatLeaf {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg); 
                opacity: 0.7; 
            }
            25% { 
                transform: translateY(-8px) rotate(5deg); 
                opacity: 1; 
            }
            50% { 
                transform: translateY(-4px) rotate(-3deg); 
                opacity: 0.8; 
            }
            75% { 
                transform: translateY(-12px) rotate(8deg); 
                opacity: 0.9; 
            }
        }

        .leaf-1 { top: 100px; left: 50px; animation-delay: 0s; }
        .leaf-2 { top: 200px; left: 300px; animation-delay: 1s; }
        .leaf-3 { top: 350px; left: 150px; animation-delay: 2s; }
        .leaf-4 { top: 450px; left: 320px; animation-delay: 3s; }

        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #FFFFFF;
            z-index: 20;
            font-family: 'Arial', sans-serif;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 8px rgba(255, 255, 255, 0.3);
            background: linear-gradient(45deg, rgba(0, 100, 0, 0.7), rgba(34, 139, 34, 0.5));
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(3px);
        }

        #level {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 14px;
            font-weight: bold;
            color: #FFD700;
            z-index: 20;
            font-family: 'Arial', sans-serif;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 6px rgba(255, 215, 0, 0.4);
            background: linear-gradient(45deg, rgba(139, 69, 19, 0.7), rgba(160, 82, 45, 0.5));
            padding: 6px 10px;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            backdrop-filter: blur(3px);
        }

        #levelUp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #2F4F2F;
            padding: 20px;
            border: 3px solid #8B7D6B;
            border-radius: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            z-index: 25;
            display: none;
            font-family: 'Arial', sans-serif;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
            animation: levelUpBounce 0.6s ease-out;
        }

        @keyframes levelUpBounce {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(47, 79, 47, 0.95), rgba(25, 25, 25, 0.9));
            padding: 30px;
            border: 3px solid #8B7D6B;
            border-radius: 20px;
            text-align: center;
            z-index: 25;
            display: none;
            font-family: 'Arial', sans-serif;
            backdrop-filter: blur(5px);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.1);
        }

        #gameOver h2 {
            color: #DC143C;
            margin-bottom: 15px;
            font-size: 22px;
            font-weight: bold;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 8px rgba(220, 20, 60, 0.4);
        }

        #gameOver p {
            margin: 10px 0;
            font-size: 14px;
            color: #F5F5DC;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
        }

        #restartBtn {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: #FFFFFF;
            border: 2px solid #006400;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-family: 'Arial', sans-serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease;
        }

        #restartBtn:hover {
            background: linear-gradient(45deg, #32CD32, #00FF32);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }

        #restartBtn:active {
            transform: translateY(0px);
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.2);
        }

        #newRecord {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.95), rgba(255, 165, 0, 0.9));
            padding: 30px;
            border: 3px solid #B8860B;
            border-radius: 20px;
            text-align: center;
            z-index: 30;
            display: none;
            font-family: 'Arial', sans-serif;
            backdrop-filter: blur(5px);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            animation: recordBounce 0.8s ease-out;
        }

        @keyframes recordBounce {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        #newRecord h2 {
            color: #8B0000;
            margin-bottom: 15px;
            font-size: 22px;
            font-weight: bold;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.3),
                0 0 8px rgba(139, 0, 0, 0.4);
        }

        #newRecord p {
            margin: 10px 0;
            font-size: 16px;
            color: #2F4F2F;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
        }

        #saveRecordBtn {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: #FFFFFF;
            border: 2px solid #006400;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-family: 'Arial', sans-serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease;
        }

        #saveRecordBtn:hover {
            background: linear-gradient(45deg, #32CD32, #00FF32);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }

        #saveRecordBtn:active {
            transform: translateY(0px);
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.2);
        }

        #currentRecord {
            font-size: 14px !important;
            color: #FFD700 !important;
            background: linear-gradient(45deg, rgba(139, 69, 19, 0.7), rgba(160, 82, 45, 0.5));
            padding: 8px 12px;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            margin: 15px 0 !important;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 6px rgba(255, 215, 0, 0.4) !important;
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #F5F5DC;
            font-size: 12px;
            z-index: 20;
            font-family: 'Arial', sans-serif;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 6px rgba(245, 245, 220, 0.3);
            background: linear-gradient(45deg, rgba(47, 79, 47, 0.6), rgba(34, 139, 34, 0.4));
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(245, 245, 220, 0.3);
            backdrop-filter: blur(3px);
        }
        
        #birthday-message {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 12px rgba(255, 215, 0, 0.6);
            font-family: 'Arial', sans-serif;
            z-index: 30;
            background: linear-gradient(45deg, rgba(255, 20, 147, 0.8), rgba(255, 105, 180, 0.6));
            padding: 12px 20px;
            border-radius: 25px;
            border: 3px solid rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: birthdayGlow 2s ease-in-out infinite alternate;
        }

        @keyframes birthdayGlow {
            0% { 
                transform: translateX(-50%) scale(1);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            }
            100% { 
                transform: translateX(-50%) scale(1.05);
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            }
        }
        
        #footer {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #F5F5DC;
            font-size: 12px;
            font-family: 'Arial', sans-serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            opacity: 0.8;
            z-index: 5;
        }

        /* Bananas confeti */
        .banana-confetti {
            position: absolute;
            font-size: 24px;
            z-index: 30;
            pointer-events: none;
            animation: bananaFall 3s ease-in forwards;
        }

        @keyframes bananaFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(700px) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div id="birthday-message">üéâ ¬°FELICIDADES MONITO! üéÇ</div>
    <div id="gameContainer">
        <!-- Fondo de la selva -->
        <div class="jungle-bg"></div>
        
        <!-- Hojas flotantes -->
        <div class="floating-leaf leaf-1"></div>
        <div class="floating-leaf leaf-2"></div>
        <div class="floating-leaf leaf-3"></div>
        <div class="floating-leaf leaf-4"></div>
        
        <!-- Mono pixel art -->
        <div id="monkey">
            <img src="monito.png" alt="Mono" width="48" height="48">
        </div>
        
        <div id="score">Puntuaci√≥n: 0</div>
        <div id="level">Nivel: 1</div>
        
        <div id="levelUp">
            <div>üéâ ¬°NIVEL COMPLETADO! üéâ</div>
            <div id="levelUpText">Nivel 2 desbloqueado</div>
        </div>
        
        <div id="gameOver">
            <h2>¬°Game Over! üôà</h2>
            <p>El monito se estrell√≥</p>
            <p id="finalScore">Puntuaci√≥n Final: 0</p>
            <p id="finalLevel">Nivel Alcanzado: 1</p>
            <p id="bestScore">Mejor Puntuaci√≥n: 0</p>
            <p id="currentRecord">üèÜ R√©cord: <span id="recordHolder">MONITO</span> - <span id="recordScore">0</span></p>
            <button id="restartBtn">üîÑ Jugar de nuevo</button>
        </div>
        
        <div id="newRecord">
            <h2>üéâ ¬°NUEVO R√âCORD! üéâ</h2>
            <p>¬°Has batido el r√©cord anterior!</p>
            <p>Puntuaci√≥n: <span id="newRecordScore">0</span></p>
            <div style="margin: 15px 0;">
                <label for="playerName" style="color: #FFD700; font-weight: bold; display: block; margin-bottom: 8px;">
                    Introduce tu nombre:
                </label>
                <input 
                    type="text" 
                    id="playerName" 
                    maxlength="10" 
                    placeholder="TU NOMBRE" 
                    style="
                        padding: 8px 12px;
                        font-size: 16px;
                        font-weight: bold;
                        text-align: center;
                        text-transform: uppercase;
                        background: linear-gradient(45deg, #2F4F2F, #1C3A1C);
                        color: #FFD700;
                        border: 2px solid #FFD700;
                        border-radius: 8px;
                        outline: none;
                        font-family: 'Arial', sans-serif;
                        width: 150px;
                    "
                />
            </div>
            <button id="saveRecordBtn">üíæ Guardar R√©cord</button>
        </div>
        
        <div id="instructions">
            üñ±Ô∏è Click o Espacio para volar ¬∑ üì± Toca en m√≥vil
        </div>
    </div>
    
    <div id="footer">
        ¬© 2025 - Hecho con ‚ù§Ô∏è por Pap√°
    </div>

    <script>
        class FlappyMonkey {
            constructor() {
                this.monkey = document.getElementById('monkey');
                this.gameContainer = document.getElementById('gameContainer');
                this.scoreElement = document.getElementById('score');
                this.levelElement = document.getElementById('level');
                this.gameOverScreen = document.getElementById('gameOver');
                this.finalScoreElement = document.getElementById('finalScore');
                this.finalLevelElement = document.getElementById('finalLevel');
                this.bestScoreElement = document.getElementById('bestScore');
                this.restartBtn = document.getElementById('restartBtn');
                this.levelUpScreen = document.getElementById('levelUp');
                this.levelUpText = document.getElementById('levelUpText');
                this.newRecordScreen = document.getElementById('newRecord');
                this.newRecordScore = document.getElementById('newRecordScore');
                this.playerNameInput = document.getElementById('playerName');
                this.saveRecordBtn = document.getElementById('saveRecordBtn');
                this.recordHolderElement = document.getElementById('recordHolder');
                this.recordScoreElement = document.getElementById('recordScore');
                
                // Sistema de audio
                this.audioContext = null;
                this.initAudio();
                
                this.monkeyY = 250;
                this.monkeyVelocity = 0;
                this.gravity = 0.5;
                this.jumpStrength = -9;
                this.score = 0;
                this.level = 1;
                this.bestScore = localStorage.getItem('bestScore') || 0;
                this.bestScoreName = localStorage.getItem('bestScoreName') || 'MONITO';
                this.gameRunning = false;
                this.trees = [];
                this.treeWidth = 80;
                this.basePipeGap = 180;
                this.basePipeSpeed = 1.5;
                this.baseSpawnRate = 3000;
                this.nextPipeTime = 0;
                
                // Sistema de niveles
                this.levels = [
                    { name: "Principiante", scoreRequired: 0, pipeGap: 220, speed: 1.0, spawnRate: 3000, gravity: 0.3 },
                    { name: "Novato", scoreRequired: 3, pipeGap: 180, speed: 1.4, spawnRate: 2600, gravity: 0.4 },
                    { name: "Aprendiz", scoreRequired: 8, pipeGap: 170, speed: 1.6, spawnRate: 2400, gravity: 0.45 },
                    { name: "Intermedio", scoreRequired: 15, pipeGap: 160, speed: 1.8, spawnRate: 2200, gravity: 0.5 },
                    { name: "Avanzado", scoreRequired: 25, pipeGap: 150, speed: 2.0, spawnRate: 2000, gravity: 0.52 },
                    { name: "Experto", scoreRequired: 35, pipeGap: 140, speed: 2.2, spawnRate: 1800, gravity: 0.55 },
                    { name: "Maestro", scoreRequired: 48, pipeGap: 130, speed: 2.4, spawnRate: 1600, gravity: 0.58 },
                    { name: "Leyenda", scoreRequired: 65, pipeGap: 125, speed: 2.6, spawnRate: 1400, gravity: 0.6 },
                    { name: "M√≠tico", scoreRequired: 85, pipeGap: 120, speed: 2.8, spawnRate: 1200, gravity: 0.62 },
                    { name: "Imposible", scoreRequired: 110, pipeGap: 110, speed: 3.0, spawnRate: 1000, gravity: 0.65 }
                ];
                
                this.init();
            }
            
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio no disponible');
                    this.audioContext = null;
                }
            }
            
            playSound(type) {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                switch(type) {
                    case 'jump':
                        // Sonido de salto - tono ascendente
                        oscillator.frequency.setValueAtTime(300, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(600, this.audioContext.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
                        oscillator.type = 'sine';
                        break;
                        
                    case 'hit':
                        // Sonido de golpe - ruido √°spero
                        oscillator.frequency.setValueAtTime(150, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.4, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                        oscillator.type = 'sawtooth';
                        break;
                        
                    case 'gameOver':
                        // Sonido de game over - tono descendente dram√°tico
                        oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, this.audioContext.currentTime + 1);
                        gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 1);
                        oscillator.type = 'triangle';
                        break;
                        
                    case 'levelUp':
                        // Sonido de level up - melod√≠a ascendente alegre
                        const frequencies = [523, 659, 784]; // Do, Mi, Sol
                        frequencies.forEach((freq, index) => {
                            setTimeout(() => {
                                const osc = this.audioContext.createOscillator();
                                const gain = this.audioContext.createGain();
                                osc.connect(gain);
                                gain.connect(this.audioContext.destination);
                                
                                osc.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                                gain.gain.setValueAtTime(0.2, this.audioContext.currentTime);
                                gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                                osc.type = 'sine';
                                
                                osc.start(this.audioContext.currentTime);
                                osc.stop(this.audioContext.currentTime + 0.3);
                            }, index * 150);
                        });
                        return; // No ejecutar el c√≥digo de abajo para levelUp
                }
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + (type === 'gameOver' ? 1 : 0.3));
            }
            
            init() {
                this.bestScoreElement.textContent = `Mejor Puntuaci√≥n: ${this.bestScore}`;
                this.updateRecordDisplay();
                this.updateLevel();
                this.bindEvents();
                this.startGame();
            }
            
            updateRecordDisplay() {
                this.recordHolderElement.textContent = this.bestScoreName;
                this.recordScoreElement.textContent = this.bestScore;
            }
            
            updateLevel() {
                // Encontrar el nivel actual basado en la puntuaci√≥n
                let newLevel = 1;
                for (let i = this.levels.length - 1; i >= 0; i--) {
                    if (this.score >= this.levels[i].scoreRequired) {
                        newLevel = i + 1;
                        break;
                    }
                }
                
                // Si subimos de nivel
                if (newLevel > this.level) {
                    this.level = newLevel;
                    this.showLevelUp();
                    this.updateGameDifficulty();
                }
                
                this.levelElement.textContent = `Nivel: ${this.level} - ${this.levels[this.level - 1].name}`;
            }
            
            updateGameDifficulty() {
                const currentLevel = this.levels[this.level - 1];
                this.gravity = currentLevel.gravity;
                this.treeSpeed = currentLevel.speed;
                this.treeGap = currentLevel.pipeGap;
                this.spawnRate = currentLevel.spawnRate;
                
                // Cambiar gradiente de fondo seg√∫n el nivel (ambientes de selva)
                const backgrounds = [
                    'linear-gradient(180deg, #87CEEB 0%, #98FB98 20%, #228B22 40%, #006400 60%, #2F4F2F 80%, #1C3A1C 100%)', // D√≠a soleado
                    'linear-gradient(180deg, #FFB347 0%, #98FB98 15%, #228B22 35%, #006400 55%, #2F4F2F 75%, #1C3A1C 100%)', // Atardecer
                    'linear-gradient(180deg, #708090 0%, #98FB98 20%, #228B22 40%, #006400 60%, #2F4F2F 80%, #0F0F0F 100%)', // Nublado
                    'linear-gradient(180deg, #4169E1 0%, #98FB98 20%, #228B22 40%, #006400 60%, #2F4F2F 80%, #1C3A1C 100%)', // Lluvioso
                    'linear-gradient(180deg, #FF6347 0%, #98FB98 15%, #228B22 35%, #006400 55%, #2F4F2F 75%, #8B0000 100%)', // Volc√°nico
                    'linear-gradient(180deg, #20B2AA 0%, #98FB98 20%, #228B22 40%, #006400 60%, #2F4F2F 80%, #1C3A1C 100%)', // Tropical
                    'linear-gradient(180deg, #9370DB 0%, #98FB98 15%, #228B22 35%, #006400 55%, #2F4F2F 75%, #2F0F2F 100%)', // M√≠stico
                    'linear-gradient(180deg, #2F4F4F 0%, #696969 20%, #228B22 40%, #006400 60%, #2F4F2F 80%, #000000 100%)', // Nocturno
                ];
                this.gameContainer.style.background = backgrounds[(this.level - 1) % backgrounds.length];
            }
            
            showLevelUp() {
                if (this.level > 1) {
                    this.levelUpText.textContent = `¬°Nivel ${this.level} - ${this.levels[this.level - 1].name}!`;
                    this.levelUpScreen.style.display = 'block';
                    
                    // Reproducir sonido de level up
                    this.playSound('levelUp');
                    
                    this.createBananaConfetti();
                    setTimeout(() => {
                        this.levelUpScreen.style.display = 'none';
                    }, 2000);
                }
            }
            
            createBananaConfetti() {
                const bananaCount = 15;
                
                for (let i = 0; i < bananaCount; i++) {
                    setTimeout(() => {
                        const banana = document.createElement('div');
                        banana.className = 'banana-confetti';
                        banana.textContent = 'üçå';
                        
                        // Posici√≥n aleatoria en el ancho del contenedor
                        banana.style.left = Math.random() * 400 + 'px';
                        banana.style.top = '-50px';
                        
                        // Variaci√≥n en el tiempo de animaci√≥n para m√°s naturalidad
                        const duration = 2.5 + Math.random() * 1; // 2.5 a 3.5 segundos
                        banana.style.animationDuration = duration + 's';
                        
                        // Variaci√≥n en el delay para que no caigan todas a la vez
                        const delay = Math.random() * 0.5; // 0 a 0.5 segundos
                        banana.style.animationDelay = delay + 's';
                        
                        this.gameContainer.appendChild(banana);
                        
                        // Eliminar la banana despu√©s de la animaci√≥n
                        setTimeout(() => {
                            if (banana.parentNode) {
                                banana.parentNode.removeChild(banana);
                            }
                        }, (duration + delay) * 1000);
                    }, i * 100); // Retraso escalonado para crear efecto lluvia
                }
            }
            
            bindEvents() {
                // Click y touch events
                this.gameContainer.addEventListener('click', () => this.jump());
                this.gameContainer.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.jump();
                });
                
                // Restart button
                this.restartBtn.addEventListener('click', () => this.restart());
                
                // Save record button
                this.saveRecordBtn.addEventListener('click', () => this.saveNewRecord());
                
                // Enter key on name input
                this.playerNameInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        this.saveNewRecord();
                    }
                });
                
                // Keyboard support
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.jump();
                    }
                });
            }
            
            startGame() {
                this.gameRunning = true;
                this.nextTreeTime = Date.now() + this.spawnRate;
                this.gameLoop();
            }
            
            jump() {
                if (!this.gameRunning) return;
                this.monkeyVelocity = this.jumpStrength;
                
                // Reproducir sonido de salto
                this.playSound('jump');
                
                // Animaci√≥n de salto
                this.monkey.style.transform = 'rotate(-20deg)';
                setTimeout(() => {
                    this.monkey.style.transform = 'rotate(0deg)';
                }, 150);
            }
            
            gameLoop() {
                if (!this.gameRunning) return;
                
                // F√≠sica del monito
                this.monkeyVelocity += this.gravity;
                this.monkeyY += this.monkeyVelocity;
                
                // Limites del juego
                if (this.monkeyY < 0) {
                    this.monkeyY = 0;
                    this.monkeyVelocity = 0;
                }
                
                if (this.monkeyY > 560) {
                    this.gameOver();
                    return;
                }
                
                // Actualizar posici√≥n del monito
                this.monkey.style.top = this.monkeyY + 'px';
                
                // Rotar monito seg√∫n velocidad
                const rotation = Math.min(Math.max(this.monkeyVelocity * 3, -30), 30);
                this.monkey.style.transform = `rotate(${rotation}deg)`;
                
                // Mover √°rboles
                this.updateTrees();
                
                // Spawn √°rboles basado en el tiempo y nivel actual
                if (Date.now() >= this.nextTreeTime) {
                    this.spawnTree();
                    this.nextTreeTime = Date.now() + this.spawnRate;
                }
                
                // Continuar el loop
                requestAnimationFrame(() => this.gameLoop());
            }
            
            spawnTree() {
                if (!this.gameRunning) return;
                
                // Variar la posici√≥n del gap basado en el nivel
                const minGapTop = 80;
                const maxGapTop = 600 - this.treeGap - 80;
                const gapStart = Math.random() * (maxGapTop - minGapTop) + minGapTop;
                
                // √Årbol superior
                const treeTop = document.createElement('div');
                treeTop.className = 'jungle-tree jungle-tree-top';
                treeTop.style.left = '400px';
                treeTop.style.height = gapStart + 'px';
                
                // √Årbol inferior
                const treeBottom = document.createElement('div');
                treeBottom.className = 'jungle-tree jungle-tree-bottom';
                treeBottom.style.left = '400px';
                treeBottom.style.height = (600 - gapStart - this.treeGap) + 'px';
                
                // Variaciones de √°rboles seg√∫n el nivel
                const treeVariations = [
                    { filter: 'hue-rotate(0deg) saturate(1)', density: 1 }, // Verde normal
                    { filter: 'hue-rotate(30deg) saturate(1.2)', density: 1.1 }, // Verde-amarillo
                    { filter: 'hue-rotate(-30deg) saturate(0.8)', density: 0.9 }, // Verde azulado
                    { filter: 'hue-rotate(60deg) saturate(1.3)', density: 1.2 }, // Amarillo-verde
                    { filter: 'hue-rotate(-60deg) saturate(1.1)', density: 1 }, // Verde-azul
                    { filter: 'hue-rotate(90deg) saturate(1.4)', density: 1.3 }, // Amarillo
                    { filter: 'hue-rotate(-90deg) saturate(0.9)', density: 0.8 }, // Azul-verde
                    { filter: 'hue-rotate(180deg) saturate(0.7)', density: 0.7 }, // Rojizo
                ];
                
                const variation = treeVariations[(this.level - 1) % treeVariations.length];
                treeTop.style.filter = variation.filter;
                treeBottom.style.filter = variation.filter;
                treeTop.style.transform = `scaleX(${variation.density})`;
                treeBottom.style.transform = `scaleX(${variation.density})`;
                
                this.gameContainer.appendChild(treeTop);
                this.gameContainer.appendChild(treeBottom);
                
                this.trees.push({
                    top: treeTop,
                    bottom: treeBottom,
                    x: 400,
                    scored: false
                });
            }
            
            updateTrees() {
                for (let i = this.trees.length - 1; i >= 0; i--) {
                    const tree = this.trees[i];
                    tree.x -= this.treeSpeed;
                    
                    // Actualizar posici√≥n visual
                    tree.top.style.left = tree.x + 'px';
                    tree.bottom.style.left = tree.x + 'px';
                    
                    // Comprobar colisi√≥n
                    if (this.checkCollision(tree)) {
                        this.playSound('hit');
                        this.gameOver();
                        return;
                    }
                    
                    // Comprobar puntuaci√≥n
                    if (!tree.scored && tree.x + this.treeWidth < 80) {
                        tree.scored = true;
                        this.score++;
                        this.scoreElement.textContent = `Puntuaci√≥n: ${this.score}`;
                        this.updateLevel();
                        
                        // Efecto de puntuaci√≥n
                        this.scoreElement.style.transform = 'scale(1.2)';
                        setTimeout(() => {
                            this.scoreElement.style.transform = 'scale(1)';
                        }, 200);
                    }
                    
                    // Eliminar √°rboles fuera de pantalla
                    if (tree.x < -this.treeWidth) {
                        tree.top.remove();
                        tree.bottom.remove();
                        this.trees.splice(i, 1);
                    }
                }
            }
            
            checkCollision(tree) {
                const monkeyLeft = 88;
                const monkeyRight = 88 + 32;
                const monkeyTop = this.monkeyY + 8;
                const monkeyBottom = this.monkeyY + 40;
                
                const treeLeft = tree.x;
                const treeRight = tree.x + this.treeWidth;
                
                // Si el monito est√° en el rango horizontal del √°rbol
                if (monkeyRight > treeLeft && monkeyLeft < treeRight) {
                    const treeTopHeight = parseInt(tree.top.style.height);
                    const treeBottomTop = 600 - parseInt(tree.bottom.style.height);
                    
                    // Comprobar colisi√≥n con √°rbol superior o inferior
                    if (monkeyTop < treeTopHeight || monkeyBottom > treeBottomTop) {
                        return true;
                    }
                }
                
                return false;
            }
            
            gameOver() {
                this.gameRunning = false;
                
                // Reproducir sonido de game over
                this.playSound('gameOver');
                
                // Comprobar si es nuevo r√©cord
                if (this.score > this.bestScore) {
                    // Es nuevo r√©cord - mostrar pantalla para introducir nombre
                    this.newRecordScore.textContent = this.score;
                    this.playerNameInput.value = '';
                    this.playerNameInput.focus();
                    this.newRecordScreen.style.display = 'block';
                    
                    // Reproducir sonido especial de r√©cord
                    setTimeout(() => this.playSound('levelUp'), 300);
                } else {
                    // No es r√©cord - mostrar game over normal
                    this.showGameOverScreen();
                }
                
                // Animaci√≥n de ca√≠da del monito
                this.monkey.style.transform = 'rotate(90deg)';
                this.monkey.style.transition = 'all 0.5s ease-out';
            }
            
            showGameOverScreen() {
                this.finalScoreElement.textContent = `Puntuaci√≥n Final: ${this.score}`;
                this.finalLevelElement.textContent = `Nivel Alcanzado: ${this.level} - ${this.levels[this.level - 1].name}`;
                this.bestScoreElement.textContent = `Mejor Puntuaci√≥n: ${this.bestScore}`;
                this.updateRecordDisplay();
                this.gameOverScreen.style.display = 'block';
            }
            
            saveNewRecord() {
                let playerName = this.playerNameInput.value.trim().toUpperCase();
                
                // Si no introduce nombre, usar valor por defecto
                if (!playerName) {
                    playerName = 'JUGADOR';
                }
                
                // Guardar nuevo r√©cord
                this.bestScore = this.score;
                this.bestScoreName = playerName;
                localStorage.setItem('bestScore', this.bestScore);
                localStorage.setItem('bestScoreName', this.bestScoreName);
                
                // Ocultar pantalla de nuevo r√©cord y mostrar game over
                this.newRecordScreen.style.display = 'none';
                this.showGameOverScreen();
                
                // Actualizar display del r√©cord
                this.updateRecordDisplay();
                
                // Resaltar el nuevo r√©cord
                this.bestScoreElement.textContent = `¬°NUEVO R√âCORD! ${this.bestScore}`;
                this.bestScoreElement.style.color = '#e74c3c';
            }
            
            restart() {
                // Limpiar √°rboles
                this.trees.forEach(tree => {
                    tree.top.remove();
                    tree.bottom.remove();
                });
                this.trees = [];
                
                // Resetear valores
                this.monkeyY = 250;
                this.monkeyVelocity = 0;
                this.score = 0;
                this.level = 1;
                this.scoreElement.textContent = 'Puntuaci√≥n: 0';
                this.gameOverScreen.style.display = 'none';
                this.levelUpScreen.style.display = 'none';
                this.newRecordScreen.style.display = 'none';
                
                // Resetear dificultad al nivel 1
                this.updateGameDifficulty();
                this.updateLevel();
                
                // Resetear monito
                this.monkey.style.top = '250px';
                this.monkey.style.transform = 'rotate(0deg)';
                this.monkey.style.transition = 'top 0.1s ease-out';
                
                // Reiniciar juego
                this.startGame();
            }
        }
        
        // Iniciar el juego cuando se carga la p√°gina
        window.addEventListener('load', () => {
            new FlappyMonkey();
        });
    </script>
</body>
</html>